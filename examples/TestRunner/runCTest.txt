cmake_minimum_required(VERSION 2.8)

EXECUTE_PROCESS(
	COMMAND hostname -f
	OUTPUT_VARIABLE CTEST_SITE
)

SET(CTEST_BUILD_NAME "$ENV{WM_PROJECT}-$ENV{WM_PROJECT_VERSION}_$ENV{WM_ARCH}_$ENV{WM_OPTIONS}_$ENV{WM_MPLIB}")
MESSAGE("Hoping for CTest Build Name: ${CTEST_BUILD_NAME}")

SET(CTEST_SOURCE_DIRECTORY ".")
SET(CTEST_BINARY_DIRECTORY ".")

SET(CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE 1000000)
SET(CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE 1000000)

FILE(GLOB runDirs ./*_runDir)

FOREACH(rd ${runDirs})
  FILE(REMOVE_RECURSE ${rd})
ENDFOREACH(rd)

ctest_start(Nightly)
ctest_test()
ctest_submit()
